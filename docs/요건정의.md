# 요건정의서

## 작업 진행 순서 (쉬운 것부터)

2번 → 4번 → 1번 → 3번 → 5번

---

## 작업 2: 뒤로가기 중복 클릭 방지

### 요약
모든 뒤로가기 버튼에 `Modifier.oneClick()` 적용하여 빠른 연속 클릭 방지

### 상세 요건
- **딜레이**: 500ms
- **구현 방식**: `Modifier.oneClick()` 확장 함수 생성, 마지막 클릭 시간을 기록하여 딜레이 내 재클릭 무시
- **적용 범위**: 앱 내 모든 뒤로가기 버튼 (IconButton의 onClick)
  - AddBookScreen, ManualBookInputScreen, BookInfoScreen, SearchBookScreen, MyBookSearchScreen 등

### 영향 파일
- `ui/.../util/ModifierUtils.kt` — `oneClick()` 확장 함수 추가
- 뒤로가기 버튼이 있는 모든 Screen 파일

---

## 작업 4: 내 서점 빈 상태 UI

### 요약
HomeScreen에 책 목록이 없을 때 "읽고 싶은 책을 추가해보세요" 안내 UI 표시

### 상세 요건
- **조건**: `storeBooks`가 빈 리스트일 때 표시
- **UI**: 화면 중앙에 안내 텍스트 배치
- **클릭 동작**: 하단 BottomNavBar의 "책 추가" 탭으로 전환 (`navController.navigate(SEARCH_BOOK_ROUTE) { popUpTo(0) }`)
- **헤더**: 빈 상태에서도 HomeHeader는 표시 (totalCount = 0)

### 영향 파일
- `ui/.../screen/HomeScreen.kt` — 빈 상태 분기 추가

---

## 작업 1: 체크박스 → 독서 시작 Bottom Dialog

### 요약
HomeScreen의 책 아이템 체크박스 클릭 시 "이 책을 시작할께요" BottomSheet를 띄우고 PATCH API로 독서 상태 변경

### 상세 요건

#### UI
- **형식**: ModalBottomSheet (BookRegisterBottomSheet 참고)
- **타이틀**: "이 책을 시작할께요."
- **내용**:
  - 독서 시작: 오늘 날짜 자동 입력 (수정 불가, DatePicker 없음)
  - 독서 종료: "읽는 중" 텍스트 표시 (수정 불가)
- **버튼**: "저장"

#### API
- **Endpoint**: `PATCH /mybooks/{mybookId}/reading-status`
- **Request Body**:
  ```json
  {
    "readingStatus": "READING",
    "startedDate": "2026-02-16"
  }
  ```
- **기존 ReadingStatusRequest** 모델을 수정하여 `startedDate` 필드 추가

#### 저장 성공 후
- Dialog 닫기
- 스낵바: "독서를 시작했어요" (SnackbarManager 사용)
- 서버 응답에 따라 내 서점 목록 새로고침 (`refreshStoreBooks()`)

### 영향 파일
- `ui/.../component/` — 새 BottomSheet 컴포넌트 또는 기존 BookRegisterBottomSheet 재활용
- `ui/.../screen/HomeScreen.kt` — 체크박스 onClick에 Dialog 연결
- `ui/.../screen/MainScreen.kt` — BottomSheet 상태 관리
- `presentation/.../viewmodel/MainViewModel.kt` — reading-status API 호출 함수 추가
- `domain/.../usecase/mybook/` — UpdateReadingStatusUseCase (기존 또는 수정)
- `data/.../model/` — ReadingStatusRequest에 startedDate 추가
- `remote/.../api/MyBookService.kt` — API 메서드 확인/수정

---

## 작업 3: 설정 화면 리뉴얼

### 요약
설정 화면에 닉네임 인사말, 닉네임 수정, 약관 링크 추가

### 상세 요건

#### UI 구조 (위→아래)
1. **인사말**: "(닉네임)님, 안녕하세요 :)"
2. **섹션 제목**: "내 정보 관리"
3. **닉네임 수정**:
   - InputField에 현재 닉네임 표시
   - 우측에 pencil(연필) 아이콘
   - pencil 클릭 → 수정 모드 활성화 → 다시 클릭(또는 확인) → PATCH API 호출
4. **회색 구분선 (Divider)**
5. **메뉴 목록**:
   - 공지사항 — 비활성화 상태 (회색 텍스트, 클릭 불가)
   - 서비스 이용약관 — 클릭 시 브라우저로 URL 열기
   - 개인정보 처리방침 — 클릭 시 브라우저로 URL 열기
6. **로그아웃 버튼** (기존 유지)

#### 닉네임 수정 API
- **Endpoint**: `PATCH /members/me`
- **Request Body**: `{"nickname": "새닉네임"}`
- **유효성 검사**: 회원가입과 동일 (최대 10자, 한글/영어/숫자 가능)
- **중복 호출 방지**: 회원가입과 동일하게 로딩 중 버튼 비활성화
- **중복 닉네임 에러 처리**: 스낵바 또는 인라인 에러 메시지

#### 약관 URL
- 서비스 이용약관: `https://scientific-ferryboat-eb1.notion.site/19f4710961a980499b90cb88b2c2ec0d?source=copy_link`
- 개인정보 처리방침: `https://scientific-ferryboat-eb1.notion.site/19f4710961a9807f98a8e1617d31b4bd?source=copy_link`
- 구현: `Intent(Intent.ACTION_VIEW, Uri.parse(url))`로 외부 브라우저 열기

### 영향 파일
- `ui/.../screen/SettingScreen.kt` — 전면 리뉴얼
- `presentation/.../viewmodel/SettingViewModel.kt` — 닉네임 수정 로직 추가
- `domain/.../usecase/member/` — UpdateNicknameUseCase 추가
- `domain/.../repository/MemberRepository.kt` — updateNickname 메서드 추가
- `data/.../repository/MemberRepositoryImpl.kt` — 구현
- `remote/.../api/MemberService.kt` — PATCH /members/me API 추가
- `remote/.../model/member/` — NicknameUpdateRequest 모델

---

## 작업 5: 책 정보 수정 Dialog

### 요약
BookInfoScreen의 "수정" 버튼 클릭 시 BottomSheet로 책 정보 수정 기능 구현

### 상세 요건

#### UI 형식
- **ModalBottomSheet** (BookRegisterBottomSheet와 동일한 스타일)
- **타이틀**: "책 정보 수정"

#### 상태별 UI 분기

| 조건 | 탭 전환 | reason | historyInfo | bookInfo 수정 |
|------|---------|--------|-------------|--------------|
| STORE + ALADIN | 내 서점/히스토리 탭 가능 | O (읽고 싶은 이유) | 히스토리 선택 시 날짜 입력 | X |
| STORE + CUSTOM | 내 서점/히스토리 탭 가능 | O | 히스토리 선택 시 날짜 입력 | O (전체 필드) |
| HISTORY + ALADIN | 내 서점/히스토리 탭 가능 | O | O (시작일/종료일) | X |
| HISTORY + CUSTOM | 내 서점/히스토리 탭 가능 | O | O (시작일/종료일) | O (전체 필드) |

#### 탭 전환
- STORE ↔ HISTORY 상태 전환 가능
- 기존 BookRegisterBottomSheet의 "내 서점" / "히스토리" 탭과 동일한 형태
- 현재 상태에 맞는 탭이 기본 선택됨

#### CUSTOM 책 bookInfo 수정 필드
ManualBookInputScreen과 동일한 입력 필드:
- 제목 (필수)
- 작가 (필수)
- 출판사
- 출간일 (yyyy-MM-dd)
- ISBN (13자리 숫자)
- 페이지 수

#### API
- **Endpoint**: `PATCH /mybooks/{mybookId}`
- **Request Body**:
  ```json
  {
    "status": "HISTORY",
    "reason": "읽고싶은 이유",
    "historyInfo": {
      "startedDate": "2025-03-01T00:50:16Z",
      "endedDate": "2025-04-01T00:50:16Z"
    },
    "bookInfo": {
      "title": "책제목",
      "author": "작가",
      "publisher": "출판사",
      "publishDate": "yyyy-MM-dd",
      "ISBN": "9123456783111",
      "totalPage": 500
    }
  }
  ```
- ALADIN 책: `bookInfo` 필드 전송하지 않음 (또는 null)
- `endedDate`: "읽는 중"인 경우 `null`

#### 저장 성공 후
- Dialog 닫기
- BookInfoScreen으로 복귀 (이전 화면)
- BookInfoScreen에서 수정된 데이터 다시 로드
- 스낵바: "책 정보를 수정했어요"

### 영향 파일
- `ui/.../component/` — BookEditBottomSheet 신규 컴포넌트
- `ui/.../screen/BookInfoScreen.kt` — 수정 버튼에 BottomSheet 연결
- `presentation/.../viewmodel/BookInfoViewModel.kt` — 수정 API 호출 로직 추가
- `domain/.../usecase/mybook/` — UpdateMyBookUseCase (기존 확인/수정)
- `domain/.../repository/MyBookRepository.kt` — updateMyBook 메서드 확인
- `data/.../model/` — MyBookUpdateEntity 수정 (status, reason, historyInfo, bookInfo)
- `remote/.../api/MyBookService.kt` — PATCH /mybooks/{mybookId} 확인
- `remote/.../model/mybook/` — MyBookUpdateRequest 수정

---

## 공통 사항

### 중복 클릭 방지
- 작업 2의 `Modifier.oneClick()`은 뒤로가기 전용
- API 호출 버튼의 중복 방지는 ViewModel의 loading 상태로 관리 (버튼 disabled)

### 스낵바
- 기존 `SnackbarManager` (Channel 기반)을 공통으로 사용
- MainScreen에서 수신하여 표시

### 에러 처리
- API 실패 시 스낵바로 에러 메시지 표시
- 네트워크 에러: "네트워크 오류가 발생했어요"
- 서버 에러: 서버 응답 메시지 또는 기본 메시지
